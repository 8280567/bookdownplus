{
    "collab_server" : "",
    "contents" : "#' Create a demo file for an .Rmd file to compile with R bookdown package.\n#'\n#' Yes, create a demo file for bookdown.\n#' @param template character, choose a template for your book or doc\n#' @param title poster tile\n#' @param author poster author\n#' @param from_address sender's address (Street and No.) for mail template\n#' @param from_town  sender's town for mail template\n#' @param from_phone sender's phone number for mail templae\n#' @param from_email sender's email for mail template\n#' @param to_who receiver's name for mail template\n#' @param to_address receiver's address (Street and No.) for mail template\n#' @param to_town receiver's town for mail template\n#' @param type mail type for mail template\n#' @param fontsize fontsize of the mail body for mail template\n#' @param email author's email for poster template\n#' @param institute for poster template\n#' @param longinstitute  for poster template\n#' @param web   for poster template\n#' @param logo  for poster template\n#' @param backimg  for poster template\n#' @param bibliofiles  for poster template\n#' @param theme  for poster template\n#' @return an .Rmd file to build with bookdown\n#' @export\n#' @examples\nbookdownplus <- function( ######\n  template = c('article',     #1, academic article\n               'article_zh',  #2, academic article in Chinese\n               'calendar',    #3, calendar, in progress\n               'chemistry',   #4, chemical molecular formulae and equations\n               'chemistry_zh',#5, in Chinese,\n               'guitar',      #6, guitar book\n               'mail',        #7, mail, in progress\n               'journal',     #8, laboratory journal, or personal diary\n               'yihui_mini',  #9, a mini demo by Yihui\n               'yihui_demo',  #10, the original demo by Yihui\n               'yihui_zh',    #11, the demo in Chinese by Yihui\n               'article_mdpi',   #12, academic article by mdpi\n               'thesis_classic', #13, classic thesis\n               'thesis_ubt',     #14, thesis of University of Bayreuth\n               'thesis_zju',  #15, thesis of Zhejiang Uni., in Chinese\n               'poem',        #16, poem\n               'poster'       #17, poster\n  )[13],\n  title ='R bookdown+: Authoring varied types of books and documents with R bookdown',\n  author = 'Peng Zhao',\n\n  # for mail template only\n  from_address = 'Maximillian Street 27',\n  from_town = '95440 Bayreuth, Germany',\n  from_phone = '62762524',\n  from_email = 'dapengde@live.com',\n  to_who = 'CAMS',\n  to_address = 'Zhongguancunnandajie 46',\n  to_town = '100000 Beijing, China',\n  type = c('business', 'personal')[2],\n  fontsize = c(\n    'tiny', 'scriptsize', 'footnotesize', 'small', 'normalsize',\n    'large', 'Large', 'LARGE', 'huge','Huge') [9],\n\n  # for poster template only\n  email = 'pzhao@pzhao.net',\n  institute = 'Institute of Ecology, Univ. Innsbruck',\n  longinstitute = 'Institute of Ecology, University of Innsbruck, Austria',\n  web = 'pzhao.org',\n  logo = 'images/logo.png',\n  backimg = 'images/logo.png',\n  bibliofiles = 'bib/bib.bib',\n  theme = c('eco', 'ocean', 'rose')[1]) {\n\n  ###### internal functions ######\n  ### copy necessary files to the working directory\n  copyfolder <- function(folder = 'images') {\n    dir.create(folder)\n    path <- paste0(.libPaths(), '/bookdownplus/', folder)\n    file.copy(from = dir(paste0(.libPaths(), '/bookdownplus/', folder), full.names = TRUE), to = folder)\n  }\n\n  ###  define body file name, dependent on the template name\n  bodyfile <- function(x) {\n    if (x == 'article_zh') return('demo/body_article_zh.Rmd')\n    if (x == 'calendar') return('demo/body_calendar.tex')\n    if (x == 'chemistry') return('demo/body_chemistry.Rmd')\n    if (x == 'chemistry_zh') return('demo/body_chemistry_zh.Rmd')\n    if (x == 'guitar') return('demo/body_guitar.Rmd')\n    if (x == 'mail') return('demo/body_mail.Rmd')\n    if (x == 'journal') return('demo/body_journal.Rmd')\n    if (x == 'yihui_zh') return('demo/body_yihui_zh.Rmd')\n    if (x == 'thesis_classic') return('demo/body_thesis_classic.Rmd')\n    if (x == 'thesis_zju') return('demo/body_thesis_zju.Rmd')\n    if (x == 'poem') return('demo/body_poem.Rmd')\n    'demo/body.Rmd'\n  }\n\n  ### backup a file to backup/ folder, avoid overwriting it.\n  backup <- function(filename, ifbackup = TRUE) {\n    if (ifbackup) {\n      if (file.exists(filename)) {\n        filenamesplit <- strsplit(filename, '\\\\.')[[1]]\n        filenamesplitl <- length(filenamesplit)\n        tolength <- ifelse(filenamesplitl > 1, filenamesplitl - 1, 1)\n        filenamepost <- filenamesplit[filenamesplitl]\n        backupfile <- paste0('backup/', paste(filenamesplit[1:tolength], collapse = '_'), '-', format(Sys.time(), '%Y-%m-%d-%H-%M-%S'), '.', filenamepost)\n        file.copy(filename, backupfile)\n        print(paste(filename, 'exsits. Backuped to', backupfile, ':)'))\n      } else {\n        print(paste(filename, 'does not exist. No need to bakcup :)'))\n      }\n    }\n  }\n\n  ###### copy folders to the working dir ######\n  lapply(X = c('backup', 'bib', 'demo', 'images', 'style','tex'), FUN = copyfolder)\n\n  ###### prepare index.Rmd ######\n  book_filename <- template\n  index <- readLines(paste0('demo/index_', template, '.Rmd'), encoding = 'UTF-8')\n  index[grep('^title: \"', index)] <- paste0('title: \"', title, '\"')\n  index[grep('^author: \"', index)] <- paste0('author: \"', author, '\"')\n  # index[grep('titleshort: \"', index)] <- paste0('titleshort: \"', titleshort, '\"')\n\n  if (template == 'poster') {\n    index[grep('^%% template=tex/poster.tex', index)] <- paste0('%% template=tex/poster_', poster_theme, '.tex')\n  }\n  backup('index.Rmd')\n  writeLines(index, 'index.Rmd', useBytes = TRUE)\n\n  if (template != 'poster') {\n\n    ###### prepare _bookdown.yml, which defines the output filename of the book. ######\n    filenameyml <- readLines('demo/_bookdown.yml', encoding = 'UTF-8')\n    filenameyml[grep('book_filename: ', filenameyml)] <- paste0('book_filename: ', book_filename)\n    backup('_bookdown.yml')\n    writeLines(filenameyml, '_bookdown.yml', useBytes = TRUE)\n\n    ###### prepare _output.yml, which defines the output files of gitbook and epub formats. comment it if you only need pdf. ######\n    backup('_output.yml')\n    # file.copy('demo/_output.yml', '_output.yml', copy.mode = FALSE, overwrite = TRUE)\n\n    ###### prepare body.Rmd ######\n    bodydemo <- bodyfile(template)\n    bodynew <- paste0('body', substr(bodydemo, nchar(bodydemo)-3, nchar(bodydemo)))\n    backup('body.Rmd')\n    file.copy(bodydemo, bodynew, copy.mode = FALSE, overwrite = TRUE)\n\n    ###### exceptions ######\n\n    ### article_zh needs an additional abstract.tex file\n    if (template == 'article_zh') {\n      backup('abstract.tex')\n      file.copy('tex/template_article_zh_abstract.tex', 'abstract.tex', copy.mode = FALSE, overwrite = TRUE)\n    }\n\n    ### mail needs an additional template_mail.tex as a before_body part.\n    if (template == 'mail') {\n      tmail <- readLines('tex/template_mail.tex')\n      tmail[51] <- paste0('{\\\\bfseries ', from_who, '}\\\\\\\\[.35ex]')\n      tmail[53] <- paste0(from_address, '\\\\\\\\')\n      tmail[54] <- paste0(from_town, '\\\\\\\\[.35ex]')\n      tmail[55] <- paste0('\\\\Telefon~', from_phone, '\\\\\\\\')\n      tmail[56] <- paste0('\\\\Letter~\\\\href{mailto:', from_email, '}{', from_email, '}')\n\n      tmail[61] <- paste0('{\\\\bfseries ', to_who, '}\\\\\\\\[.35ex]')\n      tmail[63] <- paste0(to_address, '\\\\\\\\')\n      tmail[64] <- paste0(to_town, '\\\\\\\\[.35ex]')\n\n      tmail[78] <- paste0('{\\\\bfseries ', from_who, '}\\\\\\\\')\n      tmail[75] <- paste(switch(type, 'business' = '\\\\sffamily', 'personal' = '\\\\calligra' ),\n                         fontsize, sep = '\\\\')\n      writeLines(tmail, 'tex/template_mail_user.tex')\n    }\n\n    ### article_mdpi needs an additional bst file\n    if (template == 'article_mdpi') {\n      file.copy('style/mdpi.bst', 'mdpi.bst')\n    }\n  }\n}\n",
    "created" : 1494879021791.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "738768443",
    "id" : "8F06C2B7",
    "lastKnownWriteTime" : 1494879075,
    "last_content_update" : 1494879075302,
    "path" : "D:/googledrive/a9/bookdownplus/R/fun.R",
    "project_path" : "R/fun.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}